db.collection_name.updateMany(
    { "controlsApplied.country.effectiveDate": { $exists: true } },
    [
        {
            $set: {
                controlsApplied: {
                    $map: {
                        input: "$controlsApplied",
                        as: "control",
                        in: {
                            $mergeObjects: [
                                "$$control",
                                {
                                    country: {
                                        $cond: {
                                            if: { $isObject: "$$control.country" },
                                            then: {
                                                $mergeObjects: [
                                                    "$$control.country",
                                                    {
                                                        effectiveDate: {
                                                            $cond: {
                                                                if: { $eq: ["$$control.country.effectiveDate", null] },
                                                                then: null,
                                                                else: {
                                                                    $convert: {
                                                                        input: "$$control.country.effectiveDate",
                                                                        to: "date",
                                                                        onError: null
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                ]
                                            },
                                            else: "$$control.country"
                                        }
                                    }
                                }
                            ]
                        }
                    }
                }
            }
        }
    ]
);

$(document).ready(function() {
    // Fetch the data from the backend
    $.ajax({
        url: "/api/your-endpoint",
        method: "GET",
        success: function(response) {
            // Get the container where the toggle buttons will be appended
            var container = $("#toggleContainer");

            // Loop through the data and append toggle buttons to the container
            $.each(response, function(key, value) {
                var label = $('<label class="checkbox-inline">')
                    .append(
                        $("<input>").attr({
                            type: 'checkbox',
                            class: 'toggle',
                            'data-key': key
                        }),
                        $("<span>").text(value)
                    );
                container.append(label);
            });

            // Add event listener to handle toggle state changes
            $(".toggle").on("change", function() {
                const isChecked = $(this).is(":checked");
                const state = isChecked ? "active" : "pause";
                const key = $(this).data('key');
                const dataToSend = { "key": key, "state": state };

                $.ajax({
                    url: "/your-backend-endpoint",
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(dataToSend),
                    success: function(response) {
                        console.log("Server response:", response);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error("Error:", textStatus, errorThrown);
                    }
                });
            });
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error("Error fetching data:", textStatus, errorThrown);
        }
    });
});

$(document).ready(function() {
    // Fetch the data from the backend
    $.ajax({
        url: "/api/your-endpoint",
        method: "GET",
        success: function(response) {
            // Get the container where the toggle buttons will be appended
            var container = $("#toggleContainer");

            // Loop through the data and append toggle buttons to the container
            $.each(response, function(key, value) {
                var label = $('<label class="checkbox-inline">')
                    .append(
                        $("<input>").attr({
                            type: 'checkbox',
                            class: 'toggle',
                            'data-key': key,
                            checked: value === 'active' ? 'checked' : ''
                        }),
                        $("<span>").text(key)
                    );
                container.append(label);
            });

            // Add event listener to handle toggle state changes
            $(".toggle").on("change", function() {
                const isChecked = $(this).is(":checked");
                const state = isChecked ? "active" : "pause";
                const key = $(this).data('key');
                const dataToSend = { "key": key, "state": state };

                $.ajax({
                    url: "/your-backend-endpoint",
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(dataToSend),
                    success: function(response) {
                        console.log("Server response:", response);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error("Error:", textStatus, errorThrown);
                    }
                });
            });
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error("Error fetching data:", textStatus, errorThrown);
        }
    });
});


$(document).ready(function() {
    // Fetch the data from the backend
    $.ajax({
        url: "/api/your-endpoint",
        method: "GET",
        success: function(response) {
            // Get the container where the toggle buttons will be appended
            var container = $("#toggleContainer");

            // Loop through the data and append toggle buttons to the container
            $.each(response, function(key, value) {
                var checkbox = $("<input>").attr({
                    type: 'checkbox',
                    class: 'toggle',
                    'data-key': key
                }).prop('checked', value === 'active');
                
                var label = $('<label class="checkbox-inline">')
                    .append(checkbox, $("<span>").text(key));
                    
                container.append(label);
            });

            // Add event listener to handle toggle state changes
            $(".toggle").on("change", function() {
                const isChecked = $(this).is(":checked");
                const state = isChecked ? "active" : "pause";
                const key = $(this).data('key');
                const dataToSend = { "key": key, "state": state };

                $.ajax({
                    url: "/your-backend-endpoint",
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(dataToSend),
                    success: function(response) {
                        console.log("Server response:", response);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error("Error:", textStatus, errorThrown);
                    }
                });
            });
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error("Error fetching data:", textStatus, errorThrown);
        }
    });
});

$(document).ready(function() {
    // Fetch the data from the backend
    $.ajax({
        url: "/api/your-endpoint",
        method: "GET",
        success: function(response) {
            // Get the container where the toggle buttons will be appended
            var container = $("#toggleContainer");

            // Loop through the data and append toggle buttons to the container
            $.each(response, function(key, value) {
                var checkbox = $("<input>").attr({
                    type: 'checkbox',
                    class: 'toggle',
                    'data-key': key
                }).prop('checked', value === 'active');
                
                var label = $('<label>').append(checkbox, $("<span>").text(key));
                var div = $('<div class="checkbox-container">').append(label);
                    
                container.append(div);
            });

            // Add event listener to handle toggle state changes
            $(".toggle").on("change", function() {
                const isChecked = $(this).is(":checked");
                const state = isChecked ? "active" : "pause";
                const key = $(this).data('key');
                const dataToSend = { "key": key, "state": state };

                $.ajax({
                    url: "/your-backend-endpoint",
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(dataToSend),
                    success: function(response) {
                        console.log("Server response:", response);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error("Error:", textStatus, errorThrown);
                    }
                });
            });
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error("Error fetching data:", textStatus, errorThrown);
        }
    });
});

.checkbox-container {
    margin-bottom: 10px;
}

.checkbox-container label {
    display: flex;
    align-items: center;
}

.checkbox-container label span {
    margin-left: 5px;
}

#toggleContainer {
    display: flex;
    flex-wrap: wrap;
}

.checkbox-container {
    margin-right: 20px;
    margin-bottom: 10px;
}

.checkbox-container label {
    display: flex;
    align-items: center;
}

.checkbox-container label span {
    margin-left: 5px;
}

#toggleContainer {
    display: flex;
    flex-wrap: wrap;
}

.checkbox-container {
    margin-right: 20px;
    margin-bottom: 10px;
}

.checkbox-container label {
    display: block;
}

.checkbox-container label input[type="checkbox"],
.checkbox-container label span {
    display: inline-block;
    vertical-align: middle;
}

.checkbox-container label span {
    margin-left: 5px;
}

$(document).ready(function() {
    // Fetch the data from the backend
    $.ajax({
        url: "/api/your-endpoint",
        method: "GET",
        success: function(response) {
            // Get the table where the rows will be appended
            var table = $("#toggleTable");

            // Loop through the data and append rows to the table
            $.each(response, function(key, value) {
                var checkbox = $("<input>").attr({
                    type: 'checkbox',
                    class: 'toggle',
                    'data-key': key
                }).prop('checked', value === 'active');
                
                var row = $('<tr>')
                    .append($('<td>').text(key))
                    .append($('<td>').append(checkbox));
                    
                table.append(row);
            });

            // Add event listener to handle toggle state changes
            $(".toggle").on("change", function() {
                const isChecked = $(this).is(":checked");
                const state = isChecked ? "active" : "pause";
                const key = $(this).data('key');
                const dataToSend = { "key": key, "state": state };

                $.ajax({
                    url: "/your-backend-endpoint",
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(dataToSend),
                    success: function(response) {
                        console.log("Server response:", response);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error("Error:", textStatus, errorThrown);
                    }
                });
            });
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error("Error fetching data:", textStatus, errorThrown);
        }
    });
});

<div class="container">
    <table id="toggleTable" class="table table-striped">
        <thead>
            <tr>
                <th>Key</th>
                <th>Checkbox</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rows will be added here by the JavaScript -->
        </tbody>
    </table>
</div>


$(document).ready(function() {
    // Fetch the data from the backend
    $.ajax({
        url: "/api/your-endpoint",
        method: "GET",
        success: function(response) {
            // Get the table where the rows will be appended
            var table = $("#toggleTable");

            var headerRow = $('<tr>');
            var checkboxRow = $('<tr>');

            // Loop through the data and append columns to the rows
            $.each(response, function(key, value) {
                var checkbox = $("<input>").attr({
                    type: 'checkbox',
                    class: 'toggle',
                    'data-key': key
                }).prop('checked', value === 'active');
                
                headerRow.append($('<th>').text(key));
                checkboxRow.append($('<td>').append(checkbox));
            });

            table.append(headerRow);
            table.append(checkboxRow);

            // Add event listener to handle toggle state changes
            $(".toggle").on("change", function() {
                const isChecked = $(this).is(":checked");
                const state = isChecked ? "active" : "pause";
                const key = $(this).data('key');
                const dataToSend = { "key": key, "state": state };

                $.ajax({
                    url: "/your-backend-endpoint",
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify(dataToSend),
                    success: function(response) {
                        console.log("Server response:", response);
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error("Error:", textStatus, errorThrown);
                    }
                });
            });
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error("Error fetching data:", textStatus, errorThrown);
        }
    });
});


